<div class="container">
    <div class="d-flex justify-content-center mt-4 mb-4 ">
        <img class="card-img-top" src="../../../assets/usuarios.png" alt="Imagen de usuarios" style="width: 30%;">
    </div>

    <select name="tipoUsuario" id="tipoConsulta" [(ngModel)]="tipoUsuario" (change)="cargarUsuarios()"
        class="form-select form-select-lg mb-3 rounded-pill" style="height: 35px; background-color: #ffce9d;">
        <option value="" disabled selected>Selecciona el tipo de usuarios</option>
        <option value="todos" style="text-align: center;">Usuarios Registrados</option>
        <option value="conDiploma" style="text-align: center;">Usuarios con diplomas</option>
    </select>


    @if (hayRegistros()) {
    <div class="card shadow mb-4" style="background-color: #dd5b4d;">
        @if (tipoUsuario === 'todos') {

        <div class="card-header text-center" style="background-color: #dd5b4d;">
            <h2 class="mt-3" style="color: #fff5e6;">GESTIONAR USUARIOS</h2>
            <!--             <div class="input-group  d-flex justify-content-center mt-4">
                <div class="form-outline" data-mdb-input-init>
                    <input type="text" placeholder="Buscar por email" [(ngModel)]="emailUsuario" class="form-control" />
                </div>
                <button (click)="buscarUsuario()" class="btn btn-primary mb-3">Buscar
                    <i class="fas fa-search"></i>
                </button>
            </div> -->
        </div>
        <div class="table-responsive">
            <table class="table align-middle mb-0 bg-white table-striped table-hover ">
                <thead style="text-align: center; background-color: #ffce9d;">
                    <tr>
                        <th></th>
                        <th>Usuario</th>
                        <th>Identificador</th>
                        <th>Roles</th>
                        <th></th>
                        <th></th>
                    </tr>
                </thead>
                <tbody style="text-align: center; background-color: #ffecda;">
                    @for(usuario of usuarios; track usuario.id) {
                    <tr>
                        <td><img src="{{usuario.url_foto}}" class="rounded-circle" style="width: 100px; height: 100px">
                        </td>
                        <div class="ms-3">
                            <p class="fw-bold mb-1">{{usuario.nombre | titlecase }} {{usuario.apellido_uno | titlecase
                                }}
                                {{usuario.apellido_dos | titlecase }}</p>
                            <p class="text-muted mb-0">{{usuario.email}}</p>
                        </div>
                        <td>{{usuario.id_examen}}</td>
                        <td>
                            @for (rol of usuario.roles; track rol.id) {
                            <span class="badge badge-success rounded-pill mr-3 " style="font-size: 15px;">
                                {{rol.nombre | titlecase }}</span>

                            }
                        </td>
                        <td>
                            <button class="btn btn-outline-danger " (click)="eliminarUsuario(usuario.id)"><i
                                    class="fas fa-trash"></i></button>
                        </td>
                        <td>
                            <button class="btn btn-outline-primary mr-2 " (click)="seleccionarUsuario(usuario)"><i
                                    class="fa-solid fa-hand-pointer"></i></button>
                        </td>
                    </tr>
                    }
                </tbody>
            </table>
        </div>

        <p-messages [(value)]="mensajeEliminado" [enableService]="false" [closable]="true"></p-messages>

        <p-messages [(value)]="mensajeModificado" [enableService]="false" [closable]="true"></p-messages>

        }
    </div>

    } @else {
    <p class="alert alert-warning">No hay usuarios que mostrar.</p>
    }

    @if (hayRegistrosDiplomas()){
    <div class="card shadow mb-4" style="background-color: #dd5b4d;">
        @if (tipoUsuario === 'conDiploma') {

        <div class="card-header text-center" style="background-color: #dd5b4d;">
            <h2 class="mt-3" style="color: #fff5e6;"> Usuarios con diplomas</h2>
        </div>
        <div class=" table-responsive">
            <table class="table align-middle mb-0 bg-white table-striped table-hover ">
                <thead style="text-align: center; background-color: #ffce9d;">
                    <tr>
                        <th></th>
                        <th>Usuario</th>
                        <th>Identificador</th>
                        <th>Rol</th>
                        <th>Actividad Principal</th>
                        <th>Actividad Secundaria</th>
                    </tr>
                </thead>
                <tbody style="text-align: center; background-color: #ffecda;">
                    @for(usuarioDiplomas of usuariosDiplomas; track usuarioDiplomas.id) {
                    <tr>
                        <td><img src="{{usuarioDiplomas.url_foto}}" class="rounded-circle"
                                style="width: 100px; height: 100px"></td>
                        <div class="ms-3">
                            <p class="fw-bold mb-1">{{usuarioDiplomas.nombre | titlecase }}
                                {{usuarioDiplomas.apellido_uno |
                                titlecase }}
                                {{usuarioDiplomas.apellido_dos | titlecase }}</p>
                            <p class="text-muted mb-0">{{usuarioDiplomas.email}}</p>
                        </div>
                        <td>{{usuarioDiplomas.id_examen}}</td>
                        <td>
                            @for (rol of usuarioDiplomas.roles; track rol.id) {
                            <span class="badge badge-success rounded-pill mr-3 " style="font-size: 15px;">
                                {{rol.nombre | titlecase }}</span>

                            }
                        </td>
                        <td>{{usuarioDiplomas.usuario_principal[0].actividad_principal.nombre }}</td>
                        <td>{{usuarioDiplomas.usuario_secundarias[0].act_secundaria.nombre }}</td>
                    </tr>
                    }
                </tbody>
            </table>
        </div>
        }
    </div>
    } @else {
    <p class="alert alert-warning">No hay usuarios con diploma que mostrar.</p>
    }

    <div class="container mb-3 mt-3 d-flex flex-column flex-md-row justify-content-between ">
        <div class="card shadow mb-3 mb-md-0 mr-md-3 flex-grow-1 flex-md-grow-0" style="width: 100%; max-width: 65%; background-color: #dd5b4dbc;">
            <div class="card-header text-center" style="background-color: #ffb062a4;">
                <h2 style="color: #fff5e6;">REGISTRA Y MODIFICA AFICIONADOS</h2>
            </div>
            <div class="card-body">

                <div class="d-flex justify-content-end">
                    <button class="btn btn-info " (click)="deseleccionarUsuario()"><i
                            class="fas fa-times-circle"></i></button>
                </div>
                <p style="font-size: 20px; color: #fff5e6;">
                    Email aficionado *:<input type="text" [(ngModel)]="usuario.email" class="form-control" />
                </p>
                <p style="font-size: 20px; color: #fff5e6;">
                    Nombre aficionado *:<input type="text" [(ngModel)]="usuario.nombre" class="form-control" />
                </p>

                <p style="font-size: 20px; color: #fff5e6;">
                    Primer apellido aficionado *:<input type="text" [(ngModel)]="usuario.apellido_uno"
                        class="form-control" />
                </p>
                <p style="font-size: 20px; color: #fff5e6;">
                    Segundo apellido aficionado *:<input type="text" [(ngModel)]="usuario.apellido_dos"
                        class="form-control" />
                </p>
                <p style="font-size: 20px; color: #fff5e6;">
                    Contrase√±a aficionado *:<input type="password" [(ngModel)]="usuario.password"
                        class="form-control" />
                <p style="font-size: 20px; color: #fff5e6;">
                    Foto perfil aficionado *: <input type="file" (change)="imagen($event)" />

                </p>
                <p style="font-size: 20px; color: #fff5e6;">
                    Identificador aficionado *:<input type="text" [(ngModel)]="usuario.id_examen"
                        class="form-control" />
                </p>
                <p style="font-size: 20px; color: #fff5e6;"> Seleccione un rol:</p>
                <div>
                    <input type="radio" id="admin" name="rol" [(ngModel)]="usuario.id_rol" value="1"
                        style="margin-right: 10px;">
                    <label for="admin" style="font-size: 20px; color: #fff5e6;">Admin</label><br>

                    <input type="radio" id="operador" name="rol" [(ngModel)]="usuario.id_rol" value="2"
                        style="margin-right: 10px;">
                    <label for="operador" style="font-size: 20px; color: #fff5e6;">Operador</label><br>
                </div>


                <p-messages [(value)]="mensaje" [enableService]="false" [closable]="true"></p-messages>

                <br>
                <p>

                    <button class="btn btn-success mr-2" [disabled]="usuarioSeleccionado" (click)="crearUsuario()">
                        <i class="fa-solid fa-circle-check"></i></button>
                    <button class="btn btn-warning mr-3" (click)="modificarUsuario()"><i
                            class="fas fa-edit"></i></button>

                </p>
            </div>
            <div class="card-footer  text-muted" style="background-color: #ffb062a4;">
            </div>
        </div>


        <div class="card shadow flex-grow-1 flex-md-grow-0" style="width: 100%; max-width: 35%; height: 20%; background-color: #dd5b4dbc;">
            <div class="card-header text-center" style="background-color: #ffb062a4;">
                <h2 style="color: #fff5e6;">ASIGNA ROLES A TUS AFICIONADOS</h2>
            </div>
            <div class="card-body">
                <p style="font-size: 20px; color: #fff5e6;">
                    Email aficionado:<input type="text" [(ngModel)]="usuario.email" class="form-control" />
                </p>

                <p style="font-size: 20px; color: #fff5e6;">Asignar un rol:</p>
                <div>
                    <input type="radio" id="admin" name="rolAsignar" [(ngModel)]="usuario.id_rol" value="1"
                        style="margin-right: 10px;">
                    <label for="admin" style="font-size: 20px; color: #fff5e6;">Admin</label><br>

                    <input type="radio" id="operador" name="rolAsignar" [(ngModel)]="usuario.id_rol" value="2"
                        style="margin-right: 10px;">
                    <label for="operador" style="font-size: 20px; color: #fff5e6;">Operador</label><br>
                </div>


                <p-messages [(value)]="mensajeRol" [enableService]="false" [closable]="true"></p-messages>

                <br>
                <p>
                    @if (hayRegistros()) {
                    <button class="btn btn-warning" (click)="asignarRol()">Asignar</button>
                    }
                </p>
            </div>
            <div class="card-footer  text-muted" style="background-color: #ffb062a4;">
            </div>
        </div>
    </div>
</div>